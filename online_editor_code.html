<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>EditArea - the code editor in a textarea</title>
	<!-- sintax highlight -->
	<script language="Javascript" type="text/javascript" src="./edit_area/edit_area_full.js"></script>	
	
	<!-- auto complete -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	
	<script src="keyword_auto_complete.js"></script>
	
	<script language="Javascript" type="text/javascript">
		// initialisation sintax highlight edita_area
		editAreaLoader.init({
			id: "id_code_area_ii"	// id of the textarea to transform		
			,start_highlight: true	// if start with highlight
			,allow_resize: "both"
			,allow_toggle: true
			,word_wrap: true
			,language: "en"
			,syntax: "php"	
			,toolbar: "search, go_to_line, |, undo, redo, |, select_font, |, syntax_selection, |, change_smooth_selection, highlight, reset_highlight, |, help"
			,syntax_selection_allow: "css,html,js,php,python,vb,xml,c,cpp,sql,basic,pas,brainfuck"			
			,show_line_colors: true
			
		});
		
		// callback functions
		function my_save(id, content){
			alert("Here is the content of the EditArea '"+ id +"' as received by the save callback function:\n"+content);
		}
		
		function my_load(id){
			editAreaLoader.setValue(id, "The content is loaded from the load_callback function into EditArea");
		}
		
		function test_setSelectionRange(id){
			editAreaLoader.setSelectionRange(id, 100, 150);
		}
		
		function test_getSelectionRange(id){
			var sel =editAreaLoader.getSelectionRange(id);
			alert("start: "+sel["start"]+"\nend: "+sel["end"]); 			
			//alert(sel["start"].offsetLeft); 
			//document.getElementById('id_code_area_i').style.position="absolute";
			//document.getElementById('id_code_area_i').style.marginTop = sel["start"]+ document.body.scrollLeft +'px';
			//document.getElementById('id_code_area_i').style.marginLeft = sel["end"]+'px';
			//document.getElementById('id_code_area_i').style.marginLeft = document.getElementById('id_code_area_ii').offsetLeft+'px';
			//alert(document.getElementById('id_code_area_ii').offsetLeft);
			//var elem = window.on
			//alert(elem.offsetLeft);			
			//window.scrollTo(x, y);
			
		}
		
		var cursorFocus = function(id_code_area_ii) {
			
			
			}
		
		function test_setSelectedText(id){
			text= "[REPLACED SELECTION]"; 
			editAreaLoader.setSelectedText(id, text);
		}
		
		function test_getSelectedText(id){
			alert(editAreaLoader.getSelectedText(id)); 
		}
		
		
		/*function editAreaLoaded(id){
			if(id=="example_2")
			{
				open_file1();
				open_file2();
			}
		}
		
		function open_file1()
		{
			var new_file= {id: "to\\ é # € to", text: "$authors= array();\n$news= array();", syntax: 'php', title: 'beautiful title'};
			editAreaLoader.openFile('example_2', new_file);
		}
		
		function open_file2()
		{
			var new_file= {id: "Filename", text: "<a href=\"toto\">\n\tbouh\n</a>\n<!-- it's a comment -->", syntax: 'html'};
			editAreaLoader.openFile('example_2', new_file);
		}
		
		function close_file1()
		{
			editAreaLoader.closeFile('example_2', "to\\ é # € to");
		}
		*/
		function toogle_editable(id)
		{
			editAreaLoader.execCommand(id, 'set_editable', !editAreaLoader.execCommand(id, 'is_editable'));
		}		
					
	</script>
</head>
<body>
<h2>Online Editor</h2>

<!-- auto complete -->
<div> 
<textarea id="id_code_area_i"></textarea>
</div>

<form action='' method='post'>
	<fieldset>
		<legend>Online Editor</legend>		
		<textarea id="id_code_area_ii" style="height:700px; width: 100%;" name="code_area">
<?php	
	$authors	= array();
	$news		= array();
	/* this is a long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long long comment for showing word-wrap feature */
	$query	= "SELECT author, COUNT(id) as 'nb_news' FROM news_messages GROUP BY author";
	$result	= mysql_query($query, $DBnews);
	while( $line = mysql_fetch_assoc($result) ){
		$authors[$line["author"]]	= $line["author"];
		$news[$line["author"]]		= $line['nb_news'];
	}
	
	$list= sprintf("('%s')", implode("', '", $authors));
	
	
	$query="SELECT p.people_id, p.name, p.fname, p.status, team_name, t.leader_id=p.people_id as 'team_leader', w.name as 'wp_name', w.type
			FROM people p, teams t, wppartis wp, wps w
			WHERE p.people_id IN $list AND p.org_id=t.team_id AND wp.team_id=t.team_id AND wp.wp_id=w.wp_id 
			GROUP BY p.people_id";
	if(isset($_GET["order"]) && $_GET["order"]!="nb_news")
		$query.=" ORDER BY ".$_GET["order"];
		
	$result=mysql_query($query, $DBkal);
	while($line = mysql_fetch_assoc($result)){
		printf("<tr><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>", $line["name"], $line["fname"],
			$news[$line["people_id"]], $line["status"], $line["team_name"], ($line["team_leader"]=="1")?"yes":"no", $line["type"], $line["wp_name"]);
	
	}
	printf("</table>");
?>
		</textarea>
		<p>Custom controls:<br />
			<input type='button' onclick='alert(editAreaLoader.getValue("id_code_area_i"));' value='get value' />
			<input type='button' onclick='editAreaLoader.setValue("id_code_area_ii", editAreaLoader.getValue("id_code_area_i"));' value='set value' />
			<input type='button' onclick='test_getSelectionRange("id_code_area_ii");' value='getSelectionRange' />
			<input type='button' onclick='test_setSelectionRange("example_1");' value='setSelectionRange' />
			<input type='button' onclick='test_getSelectedText("example_1");' value='getSelectedText' />
			<input type='button' onclick='test_setSelectedText("example_1");' value='setSelectedText' />
			<input type='button' onclick='editAreaLoader.insertTags("example_1", "[OPEN]", "[CLOSE]");' value='insertTags' />
			<input type='button' onclick='toogle_editable("example_1");' value='Toggle readonly mode' />
		</p>
		
	</fieldset>		     	
    
</form>



<script>


// função pra retornar ponteiro do mouse - adaptar par cursor
var isIE = document.all ? true : false;
document.onmousemove = getMousePosition;
function getMousePosition(e) {
	var _x;
	var _y;
	if (!isIE) {
		_x = e.pageX;
		_y = e.pageY;
	}
	if (isIE) {
		_x = event.clientX + document.body.scrollLeft;
		_y = event.clientY + document.body.scrollTop;
	}
	posX = _x;
	posY = _y;	
	document.getElementById('id_code_area_i').style.position="absolute";
	document.getElementById('id_code_area_i').style.marginLeft = posX+'px !important';
	document.getElementById('id_code_area_i').style.marginTop = posY;
return true;
}



///////////////
$(function() {
var availableTagsthis = availableTagsCss;
var minWordLength = 2;
function split(val) {
return val.split(' ');
}
 
function extractLast(term) {
return split(term).pop();
}
$("#id_code_area_i") // jQuery Selector
// don't navigate away from the field on tab when selecting an item
.bind("keydown", function(event) {
if (event.keyCode === $.ui.keyCode.TAB && $(this).data("ui-autocomplete").menu.active) {
event.preventDefault();
}
}).autocomplete({
minLength: minWordLength,
source: function(request, response) {
// delegate back to autocomplete, but extract the last term
var term = extractLast(request.term);
if(term.length >= minWordLength){
response($.ui.autocomplete.filter(availableTagsthis, term ));
}
},
focus: function() {
// prevent value inserted on focus
return false;
},
select: function(event, ui) {
var terms = split(this.value);
// remove the current input
terms.pop();
// add the selected item
terms.push(ui.item.value);
// add placeholder to get the comma-and-space at the end
terms.push("");
this.value = terms.join(" ");
editAreaLoader.setValue("id_code_area_ii", editAreaLoader.getValue("id_code_area_ii") + editAreaLoader.getValue("id_code_area_i"));
editAreaLoader.setValue("id_code_area_i", "");

return false;
}
});
});

$("#id_code_area_i").bind("keydown", function(event) {
var charCode = event.keyCode;
	if(charCode == 13 || charCode== 32){
	editAreaLoader.setValue("id_code_area_ii", editAreaLoader.getValue("id_code_area_ii") + editAreaLoader.getValue("id_code_area_i"));
	editAreaLoader.setValue("id_code_area_i", "");
}
});

 

</script>


</body>
</html>
